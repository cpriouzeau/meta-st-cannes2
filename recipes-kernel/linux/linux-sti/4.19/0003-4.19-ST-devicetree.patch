From 1299f4600f8aefa487c23aef8bd4a7f9a398861d Mon Sep 17 00:00:00 2001
From: Christophe Priouzeau <christophe.priouzeau@st.com>
Date: Mon, 22 Oct 2018 10:47:25 +0200
Subject: [PATCH 3/3] 4.19-ST-devicetree

---
 arch/arm/boot/dts/stih407-family.dtsi | 18 ++++++++-
 arch/arm/boot/dts/stih410-b2120.dts   |  5 +++
 arch/arm/boot/dts/stih410-b2260.dts   | 21 ++++++++--
 arch/arm/boot/dts/stih410.dtsi        | 75 +++++++++++++++++++++++++++++++++++
 4 files changed, 115 insertions(+), 4 deletions(-)

diff --git a/arch/arm/boot/dts/stih407-family.dtsi b/arch/arm/boot/dts/stih407-family.dtsi
index 9e29a44..812f579 100644
--- a/arch/arm/boot/dts/stih407-family.dtsi
+++ b/arch/arm/boot/dts/stih407-family.dtsi
@@ -53,7 +53,6 @@
 			clocks = <&clk_m_a9>;
 			clock-names = "cpu";
 			clock-latency = <100000>;
-			cpu0-supply = <&pwm_regulator>;
 			st,syscfg = <&syscfg_core 0x8e0>;
 		};
 		cpu@1 {
@@ -999,5 +998,22 @@
 				 <&clk_s_c0_flexgen CLK_ST231_DMU>,
 				 <&clk_s_c0_flexgen CLK_FLASH_PROMIP>;
 		};
+
+		rc: rc@09518000 {
+			compatible = "st,comms-irb";
+			reg = <0x09518000 0x234>;
+			interrupts = <GIC_SPI 132 IRQ_TYPE_LEVEL_HIGH>;
+			rx-mode = "infrared";
+			pinctrl-names = "default";
+			pinctrl-0 = <&pinctrl_ir
+				     &pinctrl_uhf
+				     &pinctrl_tx
+				     &pinctrl_tx_od>;
+			clocks = <&clk_sysin>;
+			resets = <&softreset STIH407_IRB_SOFTRESET>;
+
+			status = "disabled";
+		};
+
 	};
 };
diff --git a/arch/arm/boot/dts/stih410-b2120.dts b/arch/arm/boot/dts/stih410-b2120.dts
index 2a5a980..aa86fd1 100644
--- a/arch/arm/boot/dts/stih410-b2120.dts
+++ b/arch/arm/boot/dts/stih410-b2120.dts
@@ -66,5 +66,10 @@
 				status = "okay";
 			};
 		};
+
+		sti-hda@8d02000 {
+			status = "okay";
+		};
+
 	};
 };
diff --git a/arch/arm/boot/dts/stih410-b2260.dts b/arch/arm/boot/dts/stih410-b2260.dts
index 155caa8..ba184d4 100644
--- a/arch/arm/boot/dts/stih410-b2260.dts
+++ b/arch/arm/boot/dts/stih410-b2260.dts
@@ -15,7 +15,7 @@
 	compatible = "st,stih410-b2260", "st,stih410";
 
 	chosen {
-		bootargs = "clk_ignore_unused";
+		bootargs = "console=ttyAS1,115200";
 		stdout-path = &uart1;
 	};
 
@@ -55,6 +55,21 @@
 			gpios = <&pio2 5 GPIO_ACTIVE_LOW>;
 			default-state = "off";
 		};
+
+		wifi_yellow {
+			label = "Wifi_yellow";
+			gpios = <&pio4 0 GPIO_ACTIVE_LOW>;
+			linux,default-trigger = "wifi-activity";
+			default-state = "off";
+		};
+
+		bt_blue {
+			label = "Bluetooth_blue";
+			gpios = <&pio3 3 GPIO_ACTIVE_LOW>;
+			linux,default-trigger = "hci0-power";
+			default-state = "off";
+		};
+
 	};
 
 	sound: sound {
@@ -62,7 +77,7 @@
 		simple-audio-card,name = "STI-B2260";
 		status = "okay";
 
-		simple-audio-card,dai-link0 {
+		simple-audio-card,dai-link@0 {
 			/* DAC */
 			format = "i2s";
 			mclk-fs = <128>;
@@ -196,7 +211,7 @@
 			/* HDMI V1.3a supports Standard mode only */
 			clock-frequency = <100000>;
 			st,i2c-min-scl-pulse-width-us = <0>;
-			st,i2c-min-sda-pulse-width-us = <5>;
+			st,i2c-min-sda-pulse-width-us = <1>;
 			status = "okay";
 		};
 
diff --git a/arch/arm/boot/dts/stih410.dtsi b/arch/arm/boot/dts/stih410.dtsi
index 888548e..22a4359 100644
--- a/arch/arm/boot/dts/stih410.dtsi
+++ b/arch/arm/boot/dts/stih410.dtsi
@@ -15,7 +15,52 @@
 		bdisp0 = &bdisp0;
 	};
 
+	cpus {
+		cpu@0 {
+			st,syscfg = <&syscfg_core 0x8e0>;
+			st,syscfg-eng = <&syscfg_opp 0x4 0x0>;
+			clocks = <&clk_m_a9>;
+			operating-points-v2 = <&cpu0_opp_table>;
+		};
+		cpu@1 {
+			clocks = <&clk_m_a9>;
+			operating-points-v2 = <&cpu0_opp_table>;
+		};
+	};
+
+	cpu0_opp_table: opp_table0 {
+		compatible = "operating-points-v2";
+		opp-shared;
+
+		opp@1500000000 {
+			opp-supported-hw = <0xffffffff  0xffffffff  0xffffffff>;
+			opp-hz = /bits/ 64 <1500000000>;
+			clock-latency-ns = <10000000>;
+			opp-suspend;
+		};
+		opp@1200000000 {
+			opp-supported-hw = <0xffffffff  0xffffffff  0xffffffff>;
+			opp-hz = /bits/ 64 <1200000000>;
+			clock-latency-ns = <10000000>;
+		};
+		opp@800000000 {
+			opp-supported-hw = <0xffffffff  0xffffffff  0xffffffff>;
+			opp-hz = /bits/ 64 <800000000>;
+			clock-latency-ns = <10000000>;
+		};
+		opp@400000000 {
+			opp-supported-hw = <0xffffffff  0xffffffff  0xffffffff>;
+			opp-hz = /bits/ 64 <400000000>;
+			clock-latency-ns = <10000000>;
+		};
+	};
+
 	soc {
+		syscfg_opp: @08a6583c {
+			compatible = "syscon";
+			reg = <0x08a6583c 0x8>;
+		};
+
 		usb2_picophy1: phy2@0 {
 			compatible = "st,stih407-usb2-phy";
 			reg = <0 0>;
@@ -299,5 +344,35 @@
 			resets = <&softreset STIH407_LPM_SOFTRESET>;
 			hdmi-phandle = <&sti_hdmi>;
 		};
+
+		mali: mali@09f00000 {
+			compatible	= "arm,mali-400";
+			reg		= <0x09f00000 0x10000>;
+			interrupts	= <GIC_SPI 49 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 50 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 41 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 45 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 42 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 46 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 43 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 47 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 44 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 48 IRQ_TYPE_LEVEL_HIGH>;
+			interrupt-names = "IRQGP",
+					  "IRQGPMMU",
+					  "IRQPP0",
+					  "IRQPPMMU0",
+					  "IRQPP1",
+					  "IRQPPMMU1",
+					  "IRQPP2",
+					  "IRQPPMMU2",
+					  "IRQPP3",
+					  "IRQPPMMU3";
+			clock-names	= "gpu-clk";
+			clocks		= <&clk_s_c0_flexgen CLK_ICN_GPU>;
+			reset-names	= "gpu";
+			resets		= <&softreset STIH407_GPU_SOFTRESET>;
+		};
+
 	};
 };
-- 
2.7.4

