From 797e723fc84ce451e9fef9d8e932010b331d642e Mon Sep 17 00:00:00 2001
From: Christophe Priouzeau <christophe.priouzeau@st.com>
Date: Fri, 13 Dec 2019 15:31:34 +0100
Subject: [PATCH 2/2] 5.4-ST-devicetree

---
 arch/arm/boot/dts/stih407-family.dtsi | 18 ++++++-
 arch/arm/boot/dts/stih410-b2120.dts   |  5 ++
 arch/arm/boot/dts/stih410-b2260.dts   | 19 ++++++-
 arch/arm/boot/dts/stih410.dtsi        | 76 +++++++++++++++++++++++++++
 4 files changed, 115 insertions(+), 3 deletions(-)

diff --git a/arch/arm/boot/dts/stih407-family.dtsi b/arch/arm/boot/dts/stih407-family.dtsi
index 7c36c3726..aed6f9b80 100644
--- a/arch/arm/boot/dts/stih407-family.dtsi
+++ b/arch/arm/boot/dts/stih407-family.dtsi
@@ -50,7 +50,6 @@
 			clocks = <&clk_m_a9>;
 			clock-names = "cpu";
 			clock-latency = <100000>;
-			cpu0-supply = <&pwm_regulator>;
 			st,syscfg = <&syscfg_core 0x8e0>;
 		};
 		cpu@1 {
@@ -996,5 +995,22 @@
 				 <&clk_s_c0_flexgen CLK_ST231_DMU>,
 				 <&clk_s_c0_flexgen CLK_FLASH_PROMIP>;
 		};
+
+		rc: rc@09518000 {
+			compatible = "st,comms-irb";
+			reg = <0x09518000 0x234>;
+			interrupts = <GIC_SPI 132 IRQ_TYPE_LEVEL_HIGH>;
+			rx-mode = "infrared";
+			pinctrl-names = "default";
+			pinctrl-0 = <&pinctrl_ir
+				     &pinctrl_uhf
+				     &pinctrl_tx
+				     &pinctrl_tx_od>;
+			clocks = <&clk_sysin>;
+			resets = <&softreset STIH407_IRB_SOFTRESET>;
+
+			status = "disabled";
+		};
+
 	};
 };
diff --git a/arch/arm/boot/dts/stih410-b2120.dts b/arch/arm/boot/dts/stih410-b2120.dts
index 158b22687..0e966a0f7 100644
--- a/arch/arm/boot/dts/stih410-b2120.dts
+++ b/arch/arm/boot/dts/stih410-b2120.dts
@@ -63,5 +63,10 @@
 				status = "okay";
 			};
 		};
+
+		sti-hda@8d02000 {
+			status = "okay";
+		};
+
 	};
 };
diff --git a/arch/arm/boot/dts/stih410-b2260.dts b/arch/arm/boot/dts/stih410-b2260.dts
index 4fbd8e9eb..74c892f92 100644
--- a/arch/arm/boot/dts/stih410-b2260.dts
+++ b/arch/arm/boot/dts/stih410-b2260.dts
@@ -12,7 +12,7 @@
 	compatible = "st,stih410-b2260", "st,stih410";
 
 	chosen {
-		bootargs = "clk_ignore_unused";
+		bootargs = "console=ttyAS1,115200";
 		stdout-path = &uart1;
 	};
 
@@ -52,6 +52,21 @@
 			gpios = <&pio2 5 GPIO_ACTIVE_LOW>;
 			default-state = "off";
 		};
+
+		wifi_yellow {
+			label = "Wifi_yellow";
+			gpios = <&pio4 0 GPIO_ACTIVE_LOW>;
+			linux,default-trigger = "wifi-activity";
+			default-state = "off";
+		};
+
+		bt_blue {
+			label = "Bluetooth_blue";
+			gpios = <&pio3 3 GPIO_ACTIVE_LOW>;
+			linux,default-trigger = "hci0-power";
+			default-state = "off";
+		};
+
 	};
 
 	sound: sound {
@@ -196,7 +211,7 @@
 			/* HDMI V1.3a supports Standard mode only */
 			clock-frequency = <100000>;
 			st,i2c-min-scl-pulse-width-us = <0>;
-			st,i2c-min-sda-pulse-width-us = <5>;
+			st,i2c-min-sda-pulse-width-us = <1>;
 			status = "okay";
 		};
 
diff --git a/arch/arm/boot/dts/stih410.dtsi b/arch/arm/boot/dts/stih410.dtsi
index 6d847019c..8bc8b5244 100644
--- a/arch/arm/boot/dts/stih410.dtsi
+++ b/arch/arm/boot/dts/stih410.dtsi
@@ -12,7 +12,52 @@
 		bdisp0 = &bdisp0;
 	};
 
+	cpus {
+		cpu@0 {
+			st,syscfg = <&syscfg_core 0x8e0>;
+			st,syscfg-eng = <&syscfg_opp 0x4 0x0>;
+			clocks = <&clk_m_a9>;
+			operating-points-v2 = <&cpu0_opp_table>;
+		};
+		cpu@1 {
+			clocks = <&clk_m_a9>;
+			operating-points-v2 = <&cpu0_opp_table>;
+		};
+	};
+
+	cpu0_opp_table: opp_table0 {
+		compatible = "operating-points-v2";
+		opp-shared;
+
+		opp@1500000000 {
+			opp-supported-hw = <0xffffffff  0xffffffff  0xffffffff>;
+			opp-hz = /bits/ 64 <1500000000>;
+			clock-latency-ns = <10000000>;
+			opp-suspend;
+		};
+		opp@1200000000 {
+			opp-supported-hw = <0xffffffff  0xffffffff  0xffffffff>;
+			opp-hz = /bits/ 64 <1200000000>;
+			clock-latency-ns = <10000000>;
+		};
+		opp@800000000 {
+			opp-supported-hw = <0xffffffff  0xffffffff  0xffffffff>;
+			opp-hz = /bits/ 64 <800000000>;
+			clock-latency-ns = <10000000>;
+		};
+		opp@400000000 {
+			opp-supported-hw = <0xffffffff  0xffffffff  0xffffffff>;
+			opp-hz = /bits/ 64 <400000000>;
+			clock-latency-ns = <10000000>;
+		};
+	};
+
 	soc {
+		syscfg_opp: @08a6583c {
+			compatible = "syscon";
+			reg = <0x08a6583c 0x8>;
+		};
+
 		usb2_picophy1: phy2@0 {
 			compatible = "st,stih407-usb2-phy";
 			reg = <0 0>;
@@ -282,6 +327,7 @@
 			clocks = <&clk_s_c0_flexgen CLK_VID_DMU>,
 				 <&clk_s_c0_flexgen CLK_ST231_DMU>,
 				 <&clk_s_c0_flexgen CLK_FLASH_PROMIP>;
+			status = "disabled";
 		};
 
 		sti-cec@94a087c {
@@ -296,5 +342,35 @@
 			resets = <&softreset STIH407_LPM_SOFTRESET>;
 			hdmi-phandle = <&sti_hdmi>;
 		};
+
+		mali: mali@09f00000 {
+			compatible	= "arm,mali-400";
+			reg		= <0x09f00000 0x10000>;
+			interrupts	= <GIC_SPI 49 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 50 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 41 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 45 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 42 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 46 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 43 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 47 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 44 IRQ_TYPE_LEVEL_HIGH>,
+					  <GIC_SPI 48 IRQ_TYPE_LEVEL_HIGH>;
+			interrupt-names = "gp",
+					  "gpmmu",
+					  "pp0",
+					  "ppmmu0",
+					  "pp1",
+					  "ppmmu1",
+					  "pp2",
+					  "ppmmu2",
+					  "pp3",
+					  "ppmmu3";
+			clock-names	= "bus", "core";
+			clocks		= <&clk_s_c0_flexgen CLK_ICN_GPU>, <&clk_s_c0_flexgen CLK_ICN_GPU>;
+			reset-names	= "gpu";
+			resets		= <&softreset STIH407_GPU_SOFTRESET>;
+		};
+
 	};
 };
-- 
2.17.1

