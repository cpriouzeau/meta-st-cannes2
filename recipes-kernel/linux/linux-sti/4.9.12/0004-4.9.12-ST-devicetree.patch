From 9499930596db57c9b896acbd49a0d18e79897cbc Mon Sep 17 00:00:00 2001
From: Christophe Priouzeau <christophe.priouzeau@st.com>
Date: Tue, 31 Jan 2017 13:59:26 +0100
Subject: [PATCH 4/7] 4.9.12 ST: devicetree

---
 arch/arm/boot/dts/stih407-family.dtsi  | 108 ++++++++++++---------------------
 arch/arm/boot/dts/stih407-pinctrl.dtsi |  46 ++++++++++++++
 arch/arm/boot/dts/stih407.dtsi         |   2 +-
 arch/arm/boot/dts/stih410-b2120.dts    |   4 ++
 arch/arm/boot/dts/stih410-b2260.dts    |  48 ++++++++++++---
 arch/arm/boot/dts/stih410.dtsi         | 108 ++++++++++++++++++++++++++++++++-
 arch/arm/boot/dts/stihxxx-b2120.dtsi   |  44 +++++++++++++-
 7 files changed, 277 insertions(+), 83 deletions(-)

diff --git a/arch/arm/boot/dts/stih407-family.dtsi b/arch/arm/boot/dts/stih407-family.dtsi
index 8f79b41..75c22a1 100644
--- a/arch/arm/boot/dts/stih407-family.dtsi
+++ b/arch/arm/boot/dts/stih407-family.dtsi
@@ -20,30 +20,15 @@
 		#size-cells = <1>;
 		ranges;
 
-		gp0_reserved: rproc@40000000 {
+		dmu_reserved: rproc@44000000 {
 			compatible = "shared-dma-pool";
-			reg = <0x40000000 0x01000000>;
+			reg = <0x44000000 0x01000000>;
 			no-map;
-			status = "disabled";
-		};
-
-		gp1_reserved: rproc@41000000 {
-			compatible = "shared-dma-pool";
-			reg = <0x41000000 0x01000000>;
-			no-map;
-			status = "disabled";
 		};
 
-		audio_reserved: rproc@42000000 {
+		gp0_reserved: rproc@45000000 {
 			compatible = "shared-dma-pool";
-			reg = <0x42000000 0x01000000>;
-			no-map;
-			status = "disabled";
-		};
-
-		dmu_reserved: rproc@43000000 {
-			compatible = "shared-dma-pool";
-			reg = <0x43000000 0x01000000>;
+			reg = <0x45000000 0x00400000>;
 			no-map;
 		};
 	};
@@ -68,7 +53,6 @@
 			clocks = <&clk_m_a9>;
 			clock-names = "cpu";
 			clock-latency = <100000>;
-			cpu0-supply = <&pwm_regulator>;
 			st,syscfg = <&syscfg_core 0x8e0>;
 		};
 		cpu@1 {
@@ -815,7 +799,7 @@
 			status		= "okay";
 		};
 
-		st231_gp0: remote-processor {
+		st231_gp0: st231-gp0@40000000 {
 			compatible	= "st,st231-rproc";
 			memory-region	= <&gp0_reserved>;
 			resets		= <&softreset STIH407_ST231_GP0_SOFTRESET>;
@@ -823,30 +807,12 @@
 			clocks		= <&clk_s_c0_flexgen CLK_ST231_GP_0>;
 			clock-frequency	= <600000000>;
 			st,syscfg	= <&syscfg_core 0x22c>;
+			#mbox-cells = <1>;
+			mbox-names = "vq0_rx", "vq0_tx", "vq1_rx", "vq1_tx";
+			mboxes = <&mailbox0 0 2>, <&mailbox2 0 1>, <&mailbox0 0 3>, <&mailbox2 0 0>;
 		};
 
-
-		st231_gp1: remote-processor {
-			compatible	= "st,st231-rproc";
-			memory-region	= <&gp1_reserved>;
-			resets		= <&softreset STIH407_ST231_GP1_SOFTRESET>;
-			reset-names	= "sw_reset";
-			clocks		= <&clk_s_c0_flexgen CLK_ST231_GP_1>;
-			clock-frequency = <600000000>;
-			st,syscfg	= <&syscfg_core 0x220>;
-		};
-
-		st231_audio: remote-processor {
-			compatible	= "st,st231-rproc";
-			memory-region	= <&audio_reserved>;
-			resets		= <&softreset STIH407_ST231_AUD_SOFTRESET>;
-			reset-names	= "sw_reset";
-			clocks		= <&clk_s_c0_flexgen CLK_ST231_AUD_0>;
-			clock-frequency	= <600000000>;
-			st,syscfg	= <&syscfg_core 0x228>;
-		};
-
-		st231_dmu: remote-processor {
+		st231_delta: st231-delta@44000000 {
 			compatible	= "st,st231-rproc";
 			memory-region	= <&dmu_reserved>;
 			resets		= <&softreset STIH407_ST231_DMU_SOFTRESET>;
@@ -854,6 +820,9 @@
 			clocks		= <&clk_s_c0_flexgen CLK_ST231_DMU>;
 			clock-frequency	= <600000000>;
 			st,syscfg	= <&syscfg_core 0x224>;
+			#mbox-cells = <1>;
+			mbox-names = "vq0_rx", "vq0_tx", "vq1_rx", "vq1_tx";
+			mboxes = <&mailbox0 0 0>, <&mailbox3 0 1>, <&mailbox0 0 1>, <&mailbox3 0 0>;
 		};
 
 		/* fdma audio */
@@ -916,7 +885,7 @@
 		};
 
 		sti_uni_player0: sti-uni-player@8d80000 {
-			compatible = "st,sti-uni-player";
+			compatible = "st,stih407-uni-player-hdmi";
 			#sound-dai-cells = <0>;
 			st,syscfg = <&syscfg_core>;
 			clocks = <&clk_s_d0_flexgen CLK_PCM_0>;
@@ -926,17 +895,13 @@
 			reg = <0x8d80000 0x158>;
 			interrupts = <GIC_SPI 84 IRQ_TYPE_NONE>;
 			dmas = <&fdma0 2 0 1>;
-			dai-name = "Uni Player #0 (HDMI)";
 			dma-names = "tx";
-			st,uniperiph-id = <0>;
-			st,version = <5>;
-			st,mode = "HDMI";
 
 			status		= "disabled";
 		};
 
 		sti_uni_player1: sti-uni-player@8d81000 {
-			compatible = "st,sti-uni-player";
+			compatible = "st,stih407-uni-player-pcm-out";
 			#sound-dai-cells = <0>;
 			st,syscfg = <&syscfg_core>;
 			clocks = <&clk_s_d0_flexgen CLK_PCM_1>;
@@ -946,17 +911,13 @@
 			reg = <0x8d81000 0x158>;
 			interrupts = <GIC_SPI 85 IRQ_TYPE_NONE>;
 			dmas = <&fdma0 3 0 1>;
-			dai-name = "Uni Player #1 (PIO)";
 			dma-names = "tx";
-			st,uniperiph-id = <1>;
-			st,version = <5>;
-			st,mode = "PCM";
 
 			status = "disabled";
 		};
 
 		sti_uni_player2: sti-uni-player@8d82000 {
-			compatible = "st,sti-uni-player";
+			compatible = "st,stih407-uni-player-dac";
 			#sound-dai-cells = <0>;
 			st,syscfg = <&syscfg_core>;
 			clocks = <&clk_s_d0_flexgen CLK_PCM_2>;
@@ -966,17 +927,13 @@
 			reg = <0x8d82000 0x158>;
 			interrupts = <GIC_SPI 86 IRQ_TYPE_NONE>;
 			dmas = <&fdma0 4 0 1>;
-			dai-name = "Uni Player #1 (DAC)";
 			dma-names = "tx";
-			st,uniperiph-id = <2>;
-			st,version = <5>;
-			st,mode = "PCM";
 
 			status = "disabled";
 		};
 
 		sti_uni_player3: sti-uni-player@8d85000 {
-			compatible = "st,sti-uni-player";
+			compatible = "st,stih407-uni-player-spdif";
 			#sound-dai-cells = <0>;
 			st,syscfg = <&syscfg_core>;
 			clocks = <&clk_s_d0_flexgen CLK_SPDIFF>;
@@ -987,40 +944,53 @@
 			interrupts = <GIC_SPI 89 IRQ_TYPE_NONE>;
 			dmas = <&fdma0 7 0 1>;
 			dma-names = "tx";
-			dai-name = "Uni Player #1 (PIO)";
-			st,uniperiph-id = <3>;
-			st,version = <5>;
-			st,mode = "SPDIF";
 
 			status = "disabled";
 		};
 
 		sti_uni_reader0: sti-uni-reader@8d83000 {
-			compatible = "st,sti-uni-reader";
+			compatible = "st,stih407-uni-reader-pcm_in";
 			#sound-dai-cells = <0>;
 			st,syscfg = <&syscfg_core>;
 			reg = <0x8d83000 0x158>;
 			interrupts = <GIC_SPI 87 IRQ_TYPE_NONE>;
 			dmas = <&fdma0 5 0 1>;
 			dma-names = "rx";
-			dai-name = "Uni Reader #0 (PCM IN)";
-			st,version = <3>;
 
 			status = "disabled";
 		};
 
 		sti_uni_reader1: sti-uni-reader@8d84000 {
-			compatible = "st,sti-uni-reader";
+			compatible = "st,stih407-uni-reader-hdmi";
 			#sound-dai-cells = <0>;
 			st,syscfg = <&syscfg_core>;
 			reg = <0x8d84000 0x158>;
 			interrupts = <GIC_SPI 88 IRQ_TYPE_NONE>;
 			dmas = <&fdma0 6 0 1>;
 			dma-names = "rx";
-			dai-name = "Uni Reader #1 (HDMI RX)";
-			st,version = <3>;
 
 			status = "disabled";
 		};
+
+		rc: rc@09518000 {
+			compatible = "st,comms-irb";
+			reg = <0x09518000 0x234>;
+			interrupts = <GIC_SPI 132 IRQ_TYPE_NONE>;
+			rx-mode = "infrared";
+			pinctrl-names = "default";
+			pinctrl-0 = <&pinctrl_ir
+				     &pinctrl_uhf
+				     &pinctrl_tx
+				     &pinctrl_tx_od>;
+			clocks = <&clk_sysin>;
+			resets = <&softreset STIH407_IRB_SOFTRESET>;
+
+			status = "disabled";
+		};
+
+		socinfo {
+			compatible = "st,stih407-socinfo";
+			st,syscfg = <&syscfg_core>;
+		};
 	};
 };
diff --git a/arch/arm/boot/dts/stih407-pinctrl.dtsi b/arch/arm/boot/dts/stih407-pinctrl.dtsi
index c325cc0..f27ae21 100644
--- a/arch/arm/boot/dts/stih407-pinctrl.dtsi
+++ b/arch/arm/boot/dts/stih407-pinctrl.dtsi
@@ -469,6 +469,17 @@
 						rx = <&pio17 1 ALT1 IN>;
 					};
 				};
+				pinctrl_serial0_rts: serial0_rts {
+					st,pins {
+						rts = <&pio17 3 ALT1 OUT>;
+					};
+				};
+
+				pinctrl_serial0_cts: serial0_cts {
+					st,pins {
+						cts = <&pio17 2 ALT1 IN>;
+					};
+				};
 			};
 
 			serial1 {
@@ -1015,6 +1026,41 @@
 				st,retime-pin-mask = <0x7f>;
 			};
 
+			dvo {
+				pinctrl_dvo: dvo {
+					st,pins {
+						hs = <&pio30 0 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						vs = <&pio30 1 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						de = <&pio30 2 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						ck = <&pio30 3 ALT2 (OE | CLKNOTDATA) 0>;
+						d0 = <&pio30 4 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d1 = <&pio30 5 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d2 = <&pio30 6 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d3 = <&pio30 7 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d4 = <&pio31 0 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d5 = <&pio31 1 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d6 = <&pio31 2 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d7 = <&pio31 3 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d8 = <&pio31 4 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d9 = <&pio31 5 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d10 = <&pio31 6 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d11 = <&pio31 7 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d12 = <&pio32 0 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d13 = <&pio32 1 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d14 = <&pio32 2 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d15 = <&pio32 3 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d16 = <&pio32 4 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d17 = <&pio32 5 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d18 = <&pio32 6 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d19 = <&pio32 7 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d20 = <&pio33 0 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d21 = <&pio33 1 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d22 = <&pio33 2 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+						d23 = <&pio33 3 ALT2 OUT SE_NICLK_IO 0 CLK_A>;
+					};
+				};
+			};
+
 			i2c4 {
 				pinctrl_i2c4_default: i2c4-default {
 					st,pins {
diff --git a/arch/arm/boot/dts/stih407.dtsi b/arch/arm/boot/dts/stih407.dtsi
index 291ffac..fa14983 100644
--- a/arch/arm/boot/dts/stih407.dtsi
+++ b/arch/arm/boot/dts/stih407.dtsi
@@ -102,7 +102,7 @@
 							 <&clk_s_d2_quadfs 0>;
 			};
 
-			sti-hdmi@8d04000 {
+			sti_hdmi: sti-hdmi@8d04000 {
 				compatible = "st,stih407-hdmi";
 				reg = <0x8d04000 0x1000>;
 				reg-names = "hdmi-reg";
diff --git a/arch/arm/boot/dts/stih410-b2120.dts b/arch/arm/boot/dts/stih410-b2120.dts
index 118ac28..94202af 100644
--- a/arch/arm/boot/dts/stih410-b2120.dts
+++ b/arch/arm/boot/dts/stih410-b2120.dts
@@ -60,5 +60,9 @@
 		ehci1: usb@9a83e00 {
 			status = "okay";
 		};
+
+		sti-hda@8d02000 {
+			status = "okay";
+		};
 	};
 };
diff --git a/arch/arm/boot/dts/stih410-b2260.dts b/arch/arm/boot/dts/stih410-b2260.dts
index 7fb507f..49cb775 100644
--- a/arch/arm/boot/dts/stih410-b2260.dts
+++ b/arch/arm/boot/dts/stih410-b2260.dts
@@ -15,7 +15,7 @@
 	compatible = "st,stih410-b2260", "st,stih410";
 
 	chosen {
-		bootargs = "console=ttyAS1,115200 clk_ignore_unused";
+		bootargs = "console=ttyAS1,115200";
 		linux,stdout-path = &uart1;
 	};
 
@@ -57,6 +57,20 @@
 				gpios = <&pio2 5 GPIO_ACTIVE_LOW>;
 				default-state = "off";
 			};
+
+			wifi_yellow {
+				label = "Wifi_yellow";
+				gpios = <&pio4 0 GPIO_ACTIVE_LOW>;
+				linux,default-trigger = "wifi-activity";
+				default-state = "off";
+			};
+
+			bt_blue {
+				label = "Bluetooth_blue";
+				gpios = <&pio3 3 GPIO_ACTIVE_LOW>;
+				linux,default-trigger = "hci0-power";
+				default-state = "off";
+			};
 		};
 
 		/* Low speed expansion connector */
@@ -165,21 +179,19 @@
 			status = "okay";
 		};
 
+		sti_uni_player0: sti-uni-player@8d80000 {
+			status = "okay";
+		};
+
 		/* SSC11 to HDMI */
 		hdmiddc: i2c@9541000 {
 			/* HDMI V1.3a supports Standard mode only */
 			clock-frequency = <100000>;
 			st,i2c-min-scl-pulse-width-us = <0>;
-			st,i2c-min-sda-pulse-width-us = <5>;
+			st,i2c-min-sda-pulse-width-us = <1>;
 			status = "okay";
 		};
 
-		sti-display-subsystem {
-			sti_hdmi: sti-hdmi@8d04000 {
-				status = "okay";
-			};
-		};
-
 		miphy28lp_phy: miphy28lp@9b22000 {
 
 			phy_port1: port@9b2a000 {
@@ -190,5 +202,25 @@
 		sata1: sata@9b28000 {
 			status = "okay";
 		};
+
+		sound {
+			compatible = "simple-audio-card";
+			simple-audio-card,name = "STI-B2260";
+			status = "okay";
+
+			simple-audio-card,dai-link@0 {
+				/* DAC */
+				format = "i2s";
+				mclk-fs = <128>;
+				cpu {
+					sound-dai = <&sti_uni_player0>;
+				};
+
+				codec {
+					sound-dai = <&sti_hdmi>;
+				};
+			};
+		};
+
 	};
 };
diff --git a/arch/arm/boot/dts/stih410.dtsi b/arch/arm/boot/dts/stih410.dtsi
index a3ef734..8be57f7 100644
--- a/arch/arm/boot/dts/stih410.dtsi
+++ b/arch/arm/boot/dts/stih410.dtsi
@@ -14,7 +14,52 @@
 		bdisp0 = &bdisp0;
 	};
 
+	cpus {
+		cpu@0 {
+			st,syscfg = <&syscfg_core 0x8e0>;
+			st,syscfg-eng = <&syscfg_opp 0x4 0x0>;
+			clocks = <&clk_m_a9>;
+			operating-points-v2 = <&cpu0_opp_table>;
+		};
+		cpu@1 {
+			clocks = <&clk_m_a9>;
+			operating-points-v2 = <&cpu0_opp_table>;
+		};
+	};
+
+	cpu0_opp_table: opp_table0 {
+		compatible = "operating-points-v2";
+		opp-shared;
+
+		opp@1500000000 {
+			opp-supported-hw = <0xffffffff  0xffffffff  0xffffffff>;
+			opp-hz = /bits/ 64 <1500000000>;
+			clock-latency-ns = <10000000>;
+			opp-suspend;
+		};
+		opp@1200000000 {
+			opp-supported-hw = <0xffffffff  0xffffffff  0xffffffff>;
+			opp-hz = /bits/ 64 <1200000000>;
+			clock-latency-ns = <10000000>;
+		};
+		opp@800000000 {
+			opp-supported-hw = <0xffffffff  0xffffffff  0xffffffff>;
+			opp-hz = /bits/ 64 <800000000>;
+			clock-latency-ns = <10000000>;
+		};
+		opp@400000000 {
+			opp-supported-hw = <0xffffffff  0xffffffff  0xffffffff>;
+			opp-hz = /bits/ 64 <400000000>;
+			clock-latency-ns = <10000000>;
+		};
+	};
+
 	soc {
+		syscfg_opp: @08a6583c {
+			compatible = "syscon";
+			reg = <0x08a6583c 0x8>;
+		};
+
 		usb2_picophy1: phy2 {
 			compatible = "st,stih407-usb2-phy";
 			#phy-cells = <0>;
@@ -131,7 +176,7 @@
 						 <&clk_s_d2_quadfs 0>;
 
 			assigned-clock-rates = <297000000>,
-					       <108000000>,
+					       <297000000>,
 					       <0>,
 					       <400000000>,
 					       <400000000>;
@@ -193,8 +238,9 @@
 							 <&clk_s_d2_quadfs 0>;
 			};
 
-			sti-hdmi@8d04000 {
+			sti_hdmi: sti-hdmi@8d04000 {
 				compatible = "st,stih407-hdmi";
+				#sound-dai-cells = <0>;
 				reg = <0x8d04000 0x1000>;
 				reg-names = "hdmi-reg";
 				interrupts = <GIC_SPI 106 IRQ_TYPE_NONE>;
@@ -221,6 +267,7 @@
 
 			sti-hda@8d02000 {
 				compatible = "st,stih407-hda";
+				status = "disabled";
 				reg = <0x8d02000 0x400>, <0x92b0120 0x4>;
 				reg-names = "hda-reg", "video-dacs-ctrl";
 				clock-names = "pix",
@@ -232,6 +279,34 @@
 					 <&clk_s_d2_quadfs 0>,
 					 <&clk_s_d2_quadfs 1>;
 			};
+
+			sti-dvo@8d00400 {
+				compatible = "st,stih407-dvo";
+				status = "disabled";
+				reg = <0x8d00400 0x200>;
+				reg-names = "dvo-reg";
+				clock-names = "dvo_pix",
+					      "dvo",
+					      "main_parent",
+					      "aux_parent";
+				clocks = <&clk_s_d2_flexgen CLK_PIX_DVO>,
+					 <&clk_s_d2_flexgen CLK_DVO>,
+					 <&clk_s_d2_quadfs 0>,
+					 <&clk_s_d2_quadfs 1>;
+				pinctrl-names = "default";
+				pinctrl-0 = <&pinctrl_dvo>;
+			};
+
+			sti-hqvdp@9c000000 {
+				compatible = "st,stih407-hqvdp";
+				reg = <0x9C00000 0x100000>;
+				clock-names = "hqvdp", "pix_main";
+				clocks = <&clk_s_c0_flexgen CLK_MAIN_DISP>,
+					 <&clk_s_d2_flexgen CLK_PIX_MAIN_DISP>;
+				reset-names = "hqvdp";
+				resets = <&softreset STIH407_HDQVDP_SOFTRESET>;
+				st,vtg = <&vtg_main>;
+			};
 		};
 
 		bdisp0:bdisp@9f10000 {
@@ -259,5 +334,34 @@
 			clocks = <&clk_sysin>;
 			interrupts = <GIC_SPI 205 IRQ_TYPE_EDGE_RISING>;
 		};
+
+		mali: mali@09f00000 {
+			compatible	= "arm,mali-400";
+			reg		= <0x09f00000 0x10000>;
+			interrupts	= <GIC_SPI 49 IRQ_TYPE_NONE>,
+					  <GIC_SPI 50 IRQ_TYPE_NONE>,
+					  <GIC_SPI 41 IRQ_TYPE_NONE>,
+					  <GIC_SPI 45 IRQ_TYPE_NONE>,
+					  <GIC_SPI 42 IRQ_TYPE_NONE>,
+					  <GIC_SPI 46 IRQ_TYPE_NONE>,
+					  <GIC_SPI 43 IRQ_TYPE_NONE>,
+					  <GIC_SPI 47 IRQ_TYPE_NONE>,
+					  <GIC_SPI 44 IRQ_TYPE_NONE>,
+					  <GIC_SPI 48 IRQ_TYPE_NONE>;
+			interrupt-names = "IRQGP",
+					  "IRQGPMMU",
+					  "IRQPP0",
+					  "IRQPPMMU0",
+					  "IRQPP1",
+					  "IRQPPMMU1",
+					  "IRQPP2",
+					  "IRQPPMMU2",
+					  "IRQPP3",
+					  "IRQPPMMU3";
+			clock-names	= "gpu-clk";
+			clocks		= <&clk_s_c0_flexgen CLK_ICN_GPU>;
+			reset-names	= "gpu";
+			resets		= <&softreset STIH407_GPU_SOFTRESET>;
+		};
 	};
 };
diff --git a/arch/arm/boot/dts/stihxxx-b2120.dtsi b/arch/arm/boot/dts/stihxxx-b2120.dtsi
index ed2b7a9..f330c33 100644
--- a/arch/arm/boot/dts/stihxxx-b2120.dtsi
+++ b/arch/arm/boot/dts/stihxxx-b2120.dtsi
@@ -56,6 +56,15 @@
 
 		i2c@9845000 {
 			status = "okay";
+
+			#address-cells = <1>;
+			#size-cells = <0>;
+
+			eeprom@50 {
+				compatible = "at,24c256";
+				pagesize = <64>;
+				reg = <0x50>;
+			};
 		};
 
 		i2c@9540000 {
@@ -77,7 +86,7 @@
 			/* HDMI V1.3a supports Standard mode only */
 			clock-frequency = <100000>;
 			st,i2c-min-scl-pulse-width-us = <0>;
-			st,i2c-min-sda-pulse-width-us = <5>;
+			st,i2c-min-sda-pulse-width-us = <1>;
 		};
 
 		miphy28lp_phy: miphy28lp@9b22000 {
@@ -88,6 +97,8 @@
 
 			phy_port1: port@9b2a000 {
 				st,osc-force-ext;
+				/* SATA via B2136 MiniPCIe to eSATA/SATA board */
+				st,sata_gen = "gen3";
 			};
 		};
 
@@ -135,6 +146,10 @@
 			};
 		};
 
+		sti_uni_player0: sti-uni-player@8d80000 {
+			status = "okay";
+		};
+
 		sti_uni_player2: sti-uni-player@8d82000 {
 			status = "okay";
 		};
@@ -151,13 +166,26 @@
 
 		sound {
 			compatible = "simple-audio-card";
-			simple-audio-card,name = "sti audio card";
+			simple-audio-card,name = "STI-B2120";
 			status = "okay";
 
 			simple-audio-card,dai-link@0 {
+				/* HDMI */
+				format = "i2s";
+				mclk-fs = <128>;
+				cpu {
+					sound-dai = <&sti_uni_player0>;
+				};
+
+				codec {
+					sound-dai = <&sti_hdmi>;
+				};
+			};
+			simple-audio-card,dai-link@1 {
 				/* DAC */
 				format = "i2s";
 				mclk-fs = <256>;
+				frame-inversion = <1>;
 				cpu {
 					sound-dai = <&sti_uni_player2>;
 				};
@@ -166,7 +194,7 @@
 					sound-dai = <&sti_sasg_codec 1>;
 				};
 			};
-			simple-audio-card,dai-link@1 {
+			simple-audio-card,dai-link@2 {
 				/* SPDIF */
 				format = "left_j";
 				mclk-fs = <128>;
@@ -179,5 +207,15 @@
 				};
 			};
 		};
+
+
+		sata1: sata@9b28000 {
+			status = "okay";
+		};
+
+		rc: rc@09518000 {
+			status = "okay";
+			pinctrl-0 = <&pinctrl_ir>;
+		};
 	};
 };
-- 
2.7.4

