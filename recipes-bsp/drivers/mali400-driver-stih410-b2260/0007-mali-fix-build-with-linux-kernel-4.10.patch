From 5594c7abc1c8cf78187a5c145a543f3e837bb9eb Mon Sep 17 00:00:00 2001
From: Vincent Abriou <vincent.abriou@st.com>
Date: Thu, 30 Mar 2017 17:10:34 +0200
Subject: [PATCH 1/3] mali: fix build with linux kernel 4.10

Build issue introduced by:
commit 1a29d85eb "mm: use vmf->address instead of of vmf->virtual_address"
commit 82b0f8c39 "mm: join struct fault_env and vm_fault"

Change-Id: Ibc2623f8a499be328207977188389aa0a8582386
Signed-off-by: Vincent Abriou <vincent.abriou@st.com>
Reviewed-on: https://gerrit.st.com/67803
Reviewed-by: CITOOLS <smet-aci-reviews@lists.codex.cro.st.com>
---
 src/devicedrv/mali/linux/mali_memory.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/src/devicedrv/mali/linux/mali_memory.c b/src/devicedrv/mali/linux/mali_memory.c
index 95f04ed..3c5f85a 100755
--- a/src/devicedrv/mali/linux/mali_memory.c
+++ b/src/devicedrv/mali/linux/mali_memory.c
@@ -57,14 +57,15 @@ static void mali_mem_vma_close(struct vm_area_struct *vma)
 	vma->vm_private_data = NULL;
 }
 
-static int mali_mem_vma_fault(struct vm_area_struct *vma, struct vm_fault *vmf)
+static int mali_mem_vma_fault(struct vm_fault *vmf)
 {
+	struct vm_area_struct *vma = vmf->vma;
 	mali_mem_allocation *alloc = (mali_mem_allocation *)vma->vm_private_data;
 	mali_mem_backend *mem_bkend = NULL;
 	int ret;
 	int prefetch_num = MALI_VM_NUM_FAULT_PREFETCH;
 
-	unsigned long address = (unsigned long)vmf->virtual_address;
+	unsigned long address = (unsigned long)vmf->address;
 	MALI_DEBUG_ASSERT(alloc->backend_handle);
 	MALI_DEBUG_ASSERT((unsigned long)alloc->cpu_mapping.addr <= address);
 
-- 
2.7.4

